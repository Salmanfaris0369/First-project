<% include('../layouts/header.ejs')  %>

    <link
      rel="icon"
      href="/static/assets/img/kaiadmin/favicon.ico"
      type="image/x-icon"
    />

    <!-- Fonts and icons -->
    <script src="/static/adminfile/assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
      WebFont.load({
        google: { families: ["Public Sans:300,400,500,600,700"] },
        custom: {
          families: [
            "Font Awesome 5 Solid",
            "Font Awesome 5 Regular",
            "Font Awesome 5 Brands",
            "simple-line-icons",
          ],
          urls: ["assets/css/fonts.min.css"],
        },
        active: function () {
          sessionStorage.fonts = true;
        },
      });
    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="/static/adminfile/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/adminfile/assets/css/plugins.min.css" />
    <link rel="stylesheet" href="/static/adminfile/assets/css/kaiadmin.min.css" />

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" href="/static/adminfile/assets/css/demo.css" />
  

    <div class="wrapper">
      <!-- Sidebar -->
      <div class="sidebar" data-background-color="dark">
        <div class="sidebar-logo">
          <!-- Logo Header -->
          <div class="logo-header" data-background-color="white">
           
              <img
                src="img/logo.png"
                alt="navbar brand"
                class="navbar-brand"
                height="20"
              />
            
          </div>
          <!-- End Logo Header -->
        </div>
        <div class="sidebar-wrapper scrollbar scrollbar-inner">
          <div class="sidebar-content">
            <ul class="nav nav-secondary">
              <li class="nav-item active">
                <a
                  data-bs-toggle="collapse"
                  href="#dashboard"
                  class="collapsed"
                  aria-expanded="false"
                >
                  <i class="fas fa-home"></i>
                  <p>Dashboard</p>
                 </a>
              </li>
             <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/categories">
                  <i class="fas fa-pen-square"></i>
                  <p>Categories</p>
                </a>
              </li>
             <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/users">
                  <i class="fas fa-pen-square"></i>
                  <p>Users</p>
                </a>
              </li>
              <li class="nav-item">
                <a  href="/admin/product">
                  <i class="fas fa-pen-square"></i>
                  <p>products</p>
                 </a>
               </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/brand">
                  <i class="fas fa-table"></i>
                  <p>Brands</p>
                 </a>
               </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/order">
                  <i class="fas fa-map-marker-alt"></i>
                  <p>Orders</p>
               </a>
               </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/coupon">
                  <i class="far fa-chart-bar"></i>
                  <p>Coupons</p>
                </a>
               </li>
              <li class="nav-item">
                <a href="/admin/offer">
                  <i class="fas fa-desktop"></i>
                  <p>Offers</p>
                 </a>
              </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="/admin/logout">
                  <i class="fas fa-bars"></i>
                  <p>Log out</p>
                 </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- End Sidebar -->

      <div class="main-panel">
        <div class="main-header">
          <div class="main-header-logo">
            <!-- Logo Header -->
            <div class="logo-header" data-background-color="dark">
              <a href="index.html" class="logo">
                <img
                  src="assets/img/kaiadmin/logo_light.svg"
                  alt="navbar brand"
                  class="navbar-brand"
                  height="20"
                />
              </a>
              <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar">
                  <i class="gg-menu-right"></i>
                </button>
                <button class="btn btn-toggle sidenav-toggler">
                  <i class="gg-menu-left"></i>
                </button>
              </div>
              <button class="topbar-toggler more">
                <i class="gg-more-vertical-alt"></i>
              </button>
            </div>
            <!-- End Logo Header -->
          </div>
          <!-- Navbar Header -->
         
          <!-- End Navbar -->
        </div>

        <div class="container">
          <div class="page-inner">
            <div
              class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4"
            >
              <div>
                <h3 class="fw-bold mb-3">Dashboard</h3>
                
              </div>
              <div class="ms-md-auto py-2 py-md-0">
               
                <a href="/admin/dashboard/salesReport" class="btn btn-primary btn-round">Sales report</a>
              </div>
            </div>
            <div class="row">
             
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div
                          class="icon-big text-center icon-info bubble-shadow-small"
                        >
                          <i class="fas fa-user-check"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                          <p class="card-category">Return order</p>
                          <h4 class="card-title"><%= analyticsData[0].returnOrders %></h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div
                          class="icon-big text-center icon-success bubble-shadow-small"
                        >
                          <i class="fas fa-luggage-cart"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                          <p class="card-category">Sales</p>
                          <h4 class="card-title"><%= analyticsData[0].totalRevenue.toFixed(2) %></h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div
                          class="icon-big text-center icon-secondary bubble-shadow-small"
                        >
                          <i class="far fa-check-circle"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                          <p class="card-category">Order</p>
                          <h4 class="card-title"><%= analyticsData[0].totalOrders %></h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8">
                <div class="card card-round">
                  <div class="card-header">
                    <div class="card-head-row">
                      <div class="card-title">Order Statistics</div>
                      <div class="card-tools">
                        <form action="/admin/dashboard" method="GET">
                          <select name="period" onchange="this.form.submit()">
                              <option value="daily" <%= period === 'daily' ? 'selected' : '' %>>Daily</option>
                              <option value="monthly" <%= period === 'monthly' ? 'selected' : '' %>>Monthly</option>
                              <option value="yearly" <%= period === 'yearly' ? 'selected' : '' %>>Yearly</option>
                          </select>
                      </form>
                       
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart-container">
                      
                        <canvas id="revenueChart"></canvas>
                    
                     
                    </div>
                    <div id="myChartLegend"></div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card card-primary card-round">
                  <div class="card-header">
                    <div class="card-head-row">
                      <div class="card-title">Top 10 products</div>
                      <div class="card-tools">
                        
                      </div>
                    </div>
                  
                  </div>
                  <div class="card-body pb-0">
                    <div class="mb-4 mt-2">
                      <% analyticsData[0].topProducts.forEach(product => { %>
                      
                        <h5><%= product.productName %></h5>
                        
                   <% }); %>
                    </div>
                    <div class="pull-in">
                     
                    </div>
                  </div>
                </div>
               
              </div>
            </div>
           
            <div class="row">
             
          </div>
        </div>

       
      </div>

    </div>
  

    <style>
       .chart-container { width: 100%; max-width: 800px; margin: 20px auto; }
    </style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  
  
  const ctx = document.getElementById('revenueChart').getContext('2d');
  const chartData = <%- chartData %>;

  const periods = chartData.map(d => {
    if (d.period.day) return `${d.period.year}-${d.period.month}-${d.period.day}`;
    if (d.period.month) return `${d.period.year}-${d.period.month}`;
    return d.period.year.toString();
  });

  const deliveredOrders = chartData.map(d => d.deliveredOrders);
  const pendingOrders = chartData.map(d => d.pendingOrders);
  const returnOrders = chartData.map(d => d.returnOrders);
  const cancelledOrders = chartData.map(d => d.cancelledOrders);

  new Chart(ctx, {
    type: 'bar', // You can change the chart type to 'line', 'pie', or 'doughnut' if desired
    data: {
      labels: periods,
      datasets: [
        {
          label: 'Delivered Orders',
          data: deliveredOrders,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        },
        {
          label: 'Pending Orders',
          data: pendingOrders,
          backgroundColor: 'rgba(255, 206, 86, 0.2)',
          borderColor: 'rgba(255, 206, 86, 1)',
          borderWidth: 1
        },
        {
          label: 'Return Orders',
          data: returnOrders,
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        },
        {
          label: 'Cancelled Orders',
          data: cancelledOrders,
          backgroundColor: 'rgba(153, 102, 255, 0.2)',
          borderColor: 'rgba(153, 102, 255, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
  console.log(analyticsData,'dd');
</script>

    <!--   Core JS Files   -->
    <script src="/static/assets/js/core/jquery-3.7.1.min.js"></script>
    <script src="/static/assets/js/core/popper.min.js"></script>
    <script src="/static/assets/js/core/bootstrap.min.js"></script>

    <!-- jQuery Scrollbar -->
    <script src="/static/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

    <!-- Chart JS -->
    <script src="/static/assets/js/plugin/chart.js/chart.min.js"></script>

    <!-- jQuery Sparkline -->
    <script src="/static/assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

    <!-- Chart Circle -->
    <script src="/static/assets/js/plugin/chart-circle/circles.min.js"></script>

    <!-- Datatables -->
    <script src="/static/assets/js/plugin/datatables/datatables.min.js"></script>

    <!-- Bootstrap Notify -->
    <script src="/static/assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

    <!-- jQuery Vector Maps -->
    <script src="/static/assets/js/plugin/jsvectormap/jsvectormap.min.js"></script>
    <script src="/static/assets/js/plugin/jsvectormap/world.js"></script>

    <!-- Sweet Alert -->
    <script src="/static/assets/js/plugin/sweetalert/sweetalert.min.js"></script>

    <!-- Kaiadmin JS -->
    <script src="/static/assets/js/kaiadmin.min.js"></script>

    <!-- Kaiadmin DEMO methods, don't include it in your project! -->
    <script src="/static/assets/js/setting-demo.js"></script>
    <script src="/static/assets/js/demo.js"></script>
    <script>
      $("#lineChart").sparkline([102, 109, 120, 99, 110, 105, 115], {
        type: "line",
        height: "70",
        width: "100%",
        lineWidth: "2",
        lineColor: "#177dff",
        fillColor: "rgba(23, 125, 255, 0.14)",
      });

      $("#lineChart2").sparkline([99, 125, 122, 105, 110, 124, 115], {
        type: "line",
        height: "70",
        width: "100%",
        lineWidth: "2",
        lineColor: "#f3545d",
        fillColor: "rgba(243, 84, 93, .14)",
      });

      $("#lineChart3").sparkline([105, 103, 123, 100, 95, 105, 115], {
        type: "line",
        height: "70",
        width: "100%",
        lineWidth: "2",
        lineColor: "#ffa534",
        fillColor: "rgba(255, 165, 52, .14)",
      });
    </script>
  
<% include('../layouts/footer.ejs') %>